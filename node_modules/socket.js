var express = require('express');
var http = require('http');
var Redis = require('ioredis');

var app = express();
var srv = http.Server(app);
var io = require('socket.io')(srv);
var redis = new Redis();


redis.subscribe('chat-channel', function (err, count) {
	console.log('erro msg:'+err+"\n");
});

redis.on('message',function(channel,message){
	message = JSON.parse(message);
	io.emit(channel+":"+message.event,message.data);
	console.log("msg content:"+JSON.stringify(message.data));
});

srv.listen(3000,function(){
	console.log('listening on port 3000')
});